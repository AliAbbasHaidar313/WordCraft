<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordCraft - Ali Abbas Haidar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#5a3d21',   // Dark Brown
                            gold: '#ab7a44',   // Golden Brown
                            tan: '#d2b595',    // Medium Brown/Tan
                            cream: '#f4eddf',  // Light Cream
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #f4eddf; color: #5a3d21; }
        
        /* Typography adjustments for Markdown */
        .prose h1, .prose h2, .prose h3 { font-family: 'Playfair Display', serif; color: #5a3d21; margin-top: 1em; margin-bottom: 0.5em; font-weight: bold; }
        .prose h1 { font-size: 1.5rem; }
        .prose h2 { font-size: 1.25rem; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin: 0.5em 0; }
        .prose p { margin-bottom: 0.8em; line-height: 1.6; }
        .prose strong { color: #ab7a44; font-weight: 700; }
        .prose code { background: #f4eddf; padding: 2px 4px; rounded: 4px; font-size: 0.9em; color: #5a3d21; }

        /* Loader Animation */
        .loader { border-top-color: #ab7a44; -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col min-h-screen font-sans bg-brand-cream selection:bg-brand-tan selection:text-brand-dark">

    <nav class="bg-brand-cream border-b border-brand-tan py-5 px-6 flex justify-between items-center shadow-sm sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-brand-dark rounded-full flex items-center justify-center text-brand-cream">
                <i class="fas fa-feather-alt text-xl"></i>
            </div>
            <span class="text-2xl font-serif font-bold text-brand-dark tracking-wide">WordCraft</span>
        </div>
        <a href="/history" class="text-brand-dark hover:text-brand-gold font-medium transition flex items-center gap-2">
            <i class="fas fa-history"></i> <span class="hidden sm:inline">History</span>
        </a>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-6xl">
        
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, msg in messages %}
              <div class="mb-6 p-4 rounded-lg shadow-sm {{ 'bg-red-100 text-red-800 border-l-4 border-red-500' if category == 'warning' else 'bg-green-100 text-green-800 border-l-4 border-green-500' }}">
                  {{ msg }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-5 space-y-6">
                
                <form method="POST" id="mainForm" class="bg-white p-6 rounded-2xl shadow-lg border border-brand-tan/30">
                    <label class="block text-sm font-bold text-brand-dark mb-2 uppercase tracking-wider">Input Text</label>
                    <textarea name="text" id="inputText" rows="8" 
                        class="w-full p-4 border border-brand-tan rounded-xl bg-brand-cream/30 focus:ring-2 focus:ring-brand-gold focus:border-transparent outline-none transition text-brand-dark placeholder-brand-tan" 
                        placeholder="Paste your text here to begin..." required>{{ original_text or '' }}</textarea>
                    
                    <div class="mt-5">
                        <label class="block text-sm font-bold text-brand-dark mb-2 uppercase tracking-wider">Tone of Voice</label>
                        <div class="relative">
                            <select name="tone" class="w-full p-3 border border-brand-tan rounded-xl bg-white appearance-none cursor-pointer focus:ring-2 focus:ring-brand-gold outline-none text-brand-dark">
                                <option value="Professional">Professional</option>
                                <option value="Casual">Casual</option>
                                <option value="Academic">Academic</option>
                                <option value="Creative">Creative</option>
                                <option value="Persuasive">Persuasive</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-brand-dark">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 grid grid-cols-2 gap-3">
                        <button type="submit" name="action" value="proofread" class="bg-brand-dark text-brand-cream py-3 rounded-lg font-medium hover:bg-opacity-90 transition shadow-md hover:shadow-lg transform hover:-translate-y-0.5">Proofread</button>
                        <button type="submit" name="action" value="rewrite" class="bg-brand-gold text-white py-3 rounded-lg font-medium hover:bg-opacity-90 transition shadow-md hover:shadow-lg transform hover:-translate-y-0.5">Rewrite</button>
                        
                        <button type="submit" name="action" value="grammar" class="border border-brand-dark text-brand-dark py-3 rounded-lg font-medium hover:bg-brand-dark hover:text-brand-cream transition">Grammar</button>
                        <button type="submit" name="action" value="seo" class="border border-brand-gold text-brand-gold py-3 rounded-lg font-medium hover:bg-brand-gold hover:text-white transition">SEO</button>
                    </div>
                </form>

                <div class="bg-white p-6 rounded-2xl shadow-md border border-brand-tan/30">
                    <h3 class="font-bold text-brand-dark mb-4 flex items-center"><i class="fas fa-shield-alt mr-2 text-brand-gold"></i> Checks</h3>
                    <div class="space-y-3">
                        <button onclick="checkPlagiarism('web')" class="w-full bg-brand-cream text-brand-dark border border-brand-tan py-3 rounded-lg font-medium hover:bg-brand-tan hover:text-white transition flex items-center justify-center">
                            <i class="fas fa-globe mr-2"></i> Deep Web Check (Free)
                        </button>
                        <button onclick="checkPlagiarism('local')" class="w-full text-sm text-gray-500 hover:text-brand-gold underline">
                            Check local repetition
                        </button>
                    </div>
                    <div id="plagResult" class="mt-4 text-sm hidden bg-brand-cream p-3 rounded-lg border border-brand-tan"></div>
                </div>
            </div>

            <div class="lg:col-span-7">
                {% if result %}
                <div class="bg-white rounded-2xl shadow-xl border border-brand-tan/30 h-full flex flex-col overflow-hidden relative">
                    <div class="bg-brand-dark text-brand-cream px-6 py-4 flex justify-between items-center">
                        <h2 class="text-lg font-serif font-bold tracking-wide">
                            {% if action == 'seo' %}<i class="fas fa-search-dollar mr-2"></i>SEO Report
                            {% elif action == 'rewrite' %}<i class="fas fa-pen-nib mr-2"></i>Rewritten Text
                            {% else %}<i class="fas fa-check-circle mr-2"></i>Result{% endif %}
                        </h2>
                        <button onclick="copyResult()" class="text-brand-tan hover:text-white transition" title="Copy to Clipboard">
                            <i class="fas fa-copy text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="p-8 flex-grow overflow-x-auto">
                         <div id="markdownOutput" class="prose max-w-none text-brand-dark break-words whitespace-normal"></div>
                    </div>
                    
                    <textarea id="rawResult" class="hidden">{{ result }}</textarea>
                </div>
                {% else %}
                <div class="h-full flex flex-col items-center justify-center text-brand-tan bg-white/50 rounded-2xl border-2 border-dashed border-brand-tan/50 min-h-[400px]">
                    <div class="bg-brand-cream p-6 rounded-full mb-4">
                        <i class="fas fa-magic text-4xl text-brand-gold"></i>
                    </div>
                    <p class="font-serif text-lg">Select a tool to generate magic</p>
                </div>
                {% endif %}
            </div>
        </div>
    </main>

    <footer class="bg-brand-dark text-brand-tan py-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <p class="font-serif text-lg mb-2">Developed by <span class="text-white font-bold">Ali Abbas Haidar</span></p>
            <div class="flex justify-center space-x-6 mt-4">
                <a href="https://github.com/AliAbbasHaidar313" target="_blank" class="text-brand-tan hover:text-white transition transform hover:scale-110">
                    <i class="fab fa-github text-2xl"></i>
                </a>
                <a href="mailto:aliabbashaidar313@gmail.com" class="text-brand-tan hover:text-white transition transform hover:scale-110">
                    <i class="fas fa-envelope text-2xl"></i>
                </a>
            </div>
            <p class="text-xs text-brand-tan/50 mt-6">&copy; 2025 WordCraft. Creative Commons Tool.</p>
        </div>
    </footer>

    <script>
        // 1. Markdown Rendering
        document.addEventListener('DOMContentLoaded', function() {
            const raw = document.getElementById('rawResult');
            const output = document.getElementById('markdownOutput');
            if(raw && output) {
                // Parse markdown and clean HTML
                output.innerHTML = DOMPurify.sanitize(marked.parse(raw.value));
            }
        });

        // 2. Copy Function
        function copyResult() {
            const text = document.getElementById('rawResult').value;
            navigator.clipboard.writeText(text).then(() => {
                alert("Copied to clipboard!");
            }).catch(err => {
                console.error("Failed to copy:", err);
            });
        }

        // 3. Plagiarism Checker
        async function checkPlagiarism(mode) {
            const text = document.getElementById('inputText').value;
            const resDiv = document.getElementById('plagResult');
            
            if(!text) { alert("Please enter text first."); return; }
            
            // Loading State (Updated text)
            resDiv.innerHTML = '<div class="flex items-center text-brand-dark"><div class="loader ease-linear rounded-full border-2 border-t-2 border-brand-tan h-4 w-4 mr-2"></div> Scanning web (this may take a few seconds)...</div>';
            resDiv.classList.remove('hidden');

            const formData = new FormData();
            formData.append('text', text);
            formData.append('mode', mode);

            try {
                const response = await fetch('/plagiarism_check', { method: 'POST', body: formData });
                const data = await response.json();
                
                let html = '';
                
                if(mode === 'web') {
                    if(data.error) {
                        html = `<p class="text-red-600 font-bold"><i class="fas fa-exclamation-triangle"></i> ${data.error}</p>`;
                    } else if(data.web_score === 0) {
                        html = `<div class="p-2 border-l-4 border-green-500 bg-green-50">
                                    <p class="text-green-800 font-bold"><i class="fas fa-check-circle"></i> Clean (0% Plagiarism)</p>
                                    <p class="text-xs text-green-700 mt-1">Checked ${data.checked_count} sentences against the web.</p>
                                </div>`;
                    } else {
                        html = `<div class="p-2 border-l-4 border-red-500 bg-red-50">
                                    <p class="text-red-800 font-bold text-lg"><i class="fas fa-exclamation-circle"></i> ${data.web_score}% Plagiarism Detected</p>
                                    <p class="text-xs text-red-700 mt-1 mb-2">Found matches for ${data.matches.length} out of ${data.checked_count} sentences checked.</p>
                                </div>`;
                        
                        data.matches.forEach(m => {
                            html += `<div class="mt-2 p-2 bg-white rounded border border-red-100 shadow-sm">
                                <p class="text-xs italic mb-1 text-gray-600">"${m.sentence.substring(0,80)}..."</p>
                                <a href="${m.found_at}" target="_blank" class="text-brand-gold hover:underline text-xs font-bold block flex items-center">
                                    <i class="fas fa-external-link-alt mr-1"></i> Source found
                                </a>
                            </div>`;
                        });
                    }
                } else {
                    // Local Repetition
                    html = `<p class="text-brand-dark font-bold">Internal Repetition Score: <span class="${data.score > 20 ? 'text-red-600' : 'text-green-600'}">${data.score}%</span></p>`;
                }
                resDiv.innerHTML = html;
            } catch (err) {
                console.error(err);
                resDiv.innerHTML = `<p class="text-red-600">Error connecting to server. Please try again.</p>`;
            }
        }
    </script>
</body>
  </html>
  
